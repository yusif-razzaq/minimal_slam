### EKF Configuration for LiDAR + IMU Fusion ###

ekf_filter_node:
  ros__parameters:
    # Update rate (Hz)
    frequency: 30.0
    
    # Delay before publishing transforms (seconds)
    sensor_timeout: 0.1
    
    # Frames
    odom_frame: odom
    base_link_frame: base_footprint
    world_frame: odom
    
    # 2D mode (for ground robots)
    two_d_mode: true
    
    # Diagnostics
    print_diagnostics: false
    debug: false
    
    # -------------------
    # Input 0: LiDAR Odometry (from rf2o)
    # -------------------
    odom0: /odom_rf2o
    odom0_config: [true,  true,  false,    # x, y, z position
                   false, false, true,     # roll, pitch, yaw
                   true,  true,  false,    # x_dot, y_dot, z_dot velocity
                   false, false, true,     # roll_dot, pitch_dot, yaw_dot
                   false, false, false]    # x_ddot, y_ddot, z_ddot acceleration
    odom0_queue_size: 10
    odom0_differential: false
    odom0_relative: false
    
    # -------------------
    # Input 1: IMU
    # -------------------
    imu0: /imu/data
    imu0_config: [false, false, false,     # x, y, z position (IMU doesn't provide)
                  false, false, true,      # roll, pitch, yaw (use yaw orientation)
                  false, false, false,     # x_dot, y_dot, z_dot velocity
                  false, false, true,      # roll_dot, pitch_dot, yaw_dot (use yaw rate)
                  false, false, false]     # x_ddot, y_ddot, z_ddot acceleration
    imu0_queue_size: 10
    imu0_differential: false
    imu0_relative: false
    imu0_remove_gravitational_acceleration: true
    
    # -------------------
    # Process noise covariance
    # -------------------
    # Position (x, y, z)
    process_noise_covariance: [0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.06, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               # Rotation (roll, pitch, yaw)
                               0.0,  0.0,  0.0,  0.03, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.03, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.06, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               # Velocity (x_dot, y_dot, z_dot)
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.025, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.025, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.04, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               # Angular velocity (roll_dot, pitch_dot, yaw_dot)
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,
                               # Acceleration (x_ddot, y_ddot, z_ddot)
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.015]
    
    # -------------------
    # Output
    # -------------------
    # Publish filtered odometry
    publish_tf: true
    publish_acceleration: false
    
    # Use control input (if available)
    use_control: false

